<div class="listen">
  <div class="on-air-now">
    <div class="on-air-now-upper">
    {{#if model.show.about.people.firstObject.image}}
      <img class="show-image"
       alt="image for {{model.stream.currentShow.title}}"
       src="{{image-template model.show.about.people.firstObject.image.template 200 200 model.show.about.people.firstObject.image.crop}}">
    {{else}}
      <img class="show-image"
       alt="image for {{model.stream.currentShow.title}}"
       src={{model.stream.currentShow.fullImage.url}}>
    {{/if}}
    <div class="on-air-now-inner">
      <div class="on-air-now-label">ON AIR NOW</div>
      {{#if model.show.about.people.firstObject.image}}
        <img class="show-image"
         alt="image for {{model.stream.currentShow.title}}"
         src="{{image-template model.show.about.people.firstObject.image.template 352 352 model.show.about.people.firstObject.image.crop}}">
      {{else}}
        <img class="show-image"
         alt="image for {{model.stream.currentShow.title}}"
         src={{model.stream.currentShow.fullImage.url}}>
      {{/if}}
      <div class="show-title">{{model.stream.currentShow.title}}</div>
        {{#if (or twitterHandle emailAddress)}}
        <div class="message-the-show">
          <ToggleBox class="message-the-show-toggle-box" as |toggle|>
            <toggle.trigger>
              <div class="message-the-show-title">MESSAGE THE SHOW</div>
            </toggle.trigger>
            <toggle.dropdown>
              <NyprMShareTools class="listen-message-the-show-popup social-media-links" as |share|>
                <div class="social-media__container">
                  {{#if twitterHandle}}
                    <share.link @href='#' @service='twitter' @username='{{twitterHandle}}' @title='Twitter' @clickAction={{action 'openTwitterMention'}} @target='_self' />
                  {{/if}}
                  {{#if emailAddress}}
                    <share.link @service='email' @username='{{emailAddress}}' @title='Email' />
                  {{/if}}
                </div>
              </NyprMShareTools>
            </toggle.dropdown>
          </ToggleBox>
        </div>
        {{/if}}
      </div>
    </div>
    <div class="listen-play-button">
      <PlayButton
        class="play-button mod-main-page"
        data-action="Clicked Play/Pause Stream: jukebox-display"
        data-label={{model.stream.name}}
        title={{model.stream.name}}
        @playItemId={{model.stream.slug}}
        @onEnterViewport={{action "updatePlayerState" false}}
        @onExitViewport={{action "updatePlayerState" true}}
      />
    </div>
  </div>

  {{#liquid-if (or (or this.nowPlaying.composerName this.nowPlaying.trackTitle)
            (and (not this.isPlaylistHistoryPreviewStale) this.playlistHistoryItems))
  }}
    <div class="playlist-history">
      {{#if (or this.nowPlaying.composerName this.nowPlaying.trackTitle)}}
        <div class="currently-listening-to">
          <div class="currently-listening-to-label">Currently Playing</div>
          <TrackInfo
            @trackTitle={{this.nowPlaying.trackTitle}}
            @ensembleName={{this.nowPlaying.ensembleName}}
            @conductorName={{this.nowPlaying.conductorName}}
            @composerName={{this.nowPlaying.composerName}}
            @startTime={{this.nowPlaying.startTime}}
          />
        </div>
      {{/if}}

      {{#if (not this.isPlaylistHistoryPreviewStale)}}
        {{#if this.model.recentTracks}}
          <div class="recently-played">
            <div class="recently-played-label">Recent Music</div>
            <div class="recently-played-song-list">
              {{#each this.model.recentTracks as |track|}}
                <TrackInfo
                  @trackTitle={{track.title}}
                  @ensembleName={{track.ensembleName}}
                  @conductorName={{track.conductorName}}
                  @composerName={{track.composerName}}
                  @startTime={{track.startTime}}
                />
              {{/each}}
            </div>
            {{#link-to "playlist-history-today" class="view-full-playlist-history-button"}}View Full Playlist{{/link-to}}
          </div>
        {{/if}}
      {{/if}}
    </div>
  {{/liquid-if}}
</div>

{{outlet}}
